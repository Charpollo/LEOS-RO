<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEOS: First Orbit - Satellite Visualization</title>
    <link rel="stylesheet" href="css/brand-ui.css">
    <!-- Load the bundled JavaScript only once -->
    <script defer src="dist/js/bundle.js"></script>
    <style>
      /* Help modal side panel */
      #help-modal {
        pointer-events: none;
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        width: 420px;
        overflow-y: auto;
        background: rgba(0,23,40,0.95);
        color: #66d9ff;
        box-shadow: 2px 0 12px rgba(0,0,0,0.6);
        z-index: 4500;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
        padding: 1.5em;
      }
      #help-modal.open { 
        pointer-events: auto;
        transform: translateX(0); }
      /* Ensure base modal-overlay background is transparent */
      #help-modal.modal-overlay { background: none; }
      /* Pulsing glow for help sphere */
      @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(0,204,255,0.7); }
        70% { box-shadow: 0 0 0 12px rgba(0,204,255,0); }
        100% { box-shadow: 0 0 0 0 rgba(0,204,255,0); }
      }
      #help-sphere-btn {
        pointer-events: auto;
        animation: pulse 3s ease-in-out infinite;
        color: #fff;
        font-size: 1.2em;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #help-sphere-btn:hover {
        background: rgba(102,217,255,0.9);
      }
    </style>
</head>
<body>
    <div id="renderCanvas-container">
        <!-- Help Sphere Button (hidden until simulation starts) -->
        <button id="help-sphere-btn" title="Help" style="position:absolute; top:16px; left:16px; width:36px; height:36px; border-radius:50%; background:rgba(102,217,255,0.7); border:2px solid #00cfff; cursor:pointer; z-index:5000; display:none;"></button>
        <canvas id="renderCanvas" touch-action="none"></canvas>
        
        <!-- Loading Screen with Space Facts -->
        <div id="loading-screen">
            <div class="loading-content">
                <div class="leos-logo"><span class="highlight">LEOS</span>: First Orbit</div>
                <div class="loading-subtitle">
                    <span class="subtitle-word">Discover.</span>
                    <span class="subtitle-word">Engage.</span>
                    <span class="subtitle-word">Explore.</span>
                </div>
                <div class="loader">
                    <div class="loader-ring"></div>
                    <div class="loader-ring"></div>
                    <div class="loader-ring"></div>
                </div>
                <div class="space-fact" id="space-fact">
                    <p>Did you know? There are over 34,000 objects larger than 10cm currently orbiting Earth.</p>
                </div>
            </div>
        </div>

        <!-- Welcome Modal (Tutorial) -->
        <div id="welcome-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <h2 class="modal-title">Welcome to LEOS: First Orbit</h2>
                <div class="tutorial-section">
                    <h3>Controls & Navigation</h3>
                    <div class="control-item">
                        <span class="control-key">Mouse Drag</span>
                        <span class="control-desc">Rotate Earth view</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">Mouse Wheel</span>
                        <span class="control-desc">Zoom in/out</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">Click Satellite</span>
                        <span class="control-desc">View satellite info</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">R Key</span>
                        <span class="control-desc">Reset view</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">Space Key</span>
                        <span class="control-desc">Pause/Resume</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">Click Ground Station</span>
                        <span class="control-desc">View ground station info</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">Click Time Display</span>
                        <span class="control-desc">Open time controls</span>
                    </div>
                </div>
                <button id="got-it-btn" class="primary-button">Got it!</button>
            </div>
        </div>

        <!-- Help Info Panel -->
        <div id="help-modal">
            <div class="modal-content">
                <h2 class="modal-title">Welcome to LEOS: First Orbit</h2>
                <div class="modal-subtitle" style="margin:0.5em 0; font-style:italic;">Discover. Engage. Explore.</div>
                <p class="section-content">LEOS: First Orbit places you in the heart of real-time space operations. Track CRTS-1 and Bulldog as they move through Low Earth Orbit, observe orbital mechanics in action, and explore a fully interactive 3D view of Earth, the Moon, and surrounding space.</p>
                <div class="section-content" style="margin-top:1em;">
                    <p>ðŸ›° <strong>CRTS-1</strong> captures Earth imagery with advanced optical sensors</p>
                    <p>ðŸ›° <strong>Bulldog</strong> functions as an experimental support and research platform</p>
                </div>
                <p class="section-content" style="margin-top:1em;">Rotate the planet, zoom through space, follow satellite paths, and uncover the dynamics of orbit in motion. From launch to passover, LEOS invites you to experience the flow of space like never before.</p>
                <p class="section-content" style="margin-top:1em; font-weight:bold;">Your simulation has started. The orbit is live.</p>
                <div class="modal-actions" style="margin-top:auto;">
                    <button id="help-show-tutorial" class="primary-button">Show Tutorial</button>
                    <button id="help-close-btn" class="secondary-button">Close</button>
                </div>
            </div>
        </div>

        <!-- Left Info Panel (Mission Briefing) -->
        <div id="info-panel" class="info-panel">
            <div class="panel-header">
                <h1 class="panel-title">LEOS: First Orbit</h1>
                <button id="close-panel" class="close-button">&times;</button>
            </div>
            
            <div class="panel-section">
                <h2 class="section-title">The LEOS Engine</h2>
                <p class="section-content">
                    The Low Earth Orbit Simulation (LEOS) engine provides real-time orbital mechanics 
                    visualization using advanced 3D rendering and physics calculations. Experience 
                    satellite behavior in a scientifically accurate environment.
                </p>
            </div>
            
            <div class="panel-section">
                <h2 class="section-title">About the Satellites</h2>
                <p class="section-content">
                    Our simulation features active satellites with real telemetry data, including 
                    position, velocity, altitude, and orbital parameters. Each satellite follows 
                    precise Keplerian orbital mechanics.
                </p>
            </div>
            
            <div class="panel-section">
                <h2 class="section-title">Orbital Mechanics</h2>
                <p class="section-content">
                    Watch as satellites follow elliptical orbits, experience orbital decay, and 
                    maintain their trajectories around Earth. The simulation accounts for 
                    gravitational forces and orbital perturbations.
                </p>
            </div>

            <div class="panel-controls">
                <button id="show-tutorial" class="secondary-button">Show Tutorial</button>
            </div>
        </div>
        
        <!-- Floating Time Display -->
        <div id="time-display" class="floating-display" style="position:absolute; top:24px; left:50%; transform:translateX(-50%); z-index:3000; min-width:220px; text-align:center;">
            <div id="current-time" style="font-size:1.18em; font-weight:600; letter-spacing:0.04em; color:#66d9ff; background:rgba(0,23,40,0.92); border-radius:8px; padding:0.5em 1.2em; box-shadow:0 2px 12px #00cfff33; border:1px solid #00cfff; display:inline-block; cursor:pointer;">
                00:00:00 UTC
            </div>
            <div id="time-controls" class="time-controls-panel hidden" style="margin-top:8px;">
                <button class="time-btn speed-btn" data-mult="0.25">0.25x</button>
                <button class="time-btn speed-btn" data-mult="0.5">0.5x</button>
                <button class="time-btn speed-btn" data-mult="1">1x</button>
                <button class="time-btn speed-btn" data-mult="2">2x</button>
                <button class="time-btn speed-btn" data-mult="4">4x</button>
            </div>
            <div id="time-info-note" style="display:none; position:absolute; left:50%; top:calc(100% + 18px); transform:translateX(-50%); min-width:600px; max-width:900px; background:rgba(10,18,32,0.98); color:#66d9ff; font-size:1em; border-radius:22px; box-shadow:0 8px 36px #00cfff22; padding:1.5em 2.8em 1.5em 2.2em; z-index:3500; text-align:left; border:none; line-height:1.7; pointer-events:auto; outline:none; display:flex; flex-direction:column; gap:0.5em; align-items:flex-start; font-weight:400; opacity:0.97;">
                <b>Tip:</b> Simulation time runs at a 60:1 ratio (1 real second = 1 simulated minute). The speed you select multiplies this effect.
            </div>
        </div>
        
        <!-- Mission Dashboard Overlay (hidden by default) -->
        <div id="mission-dashboard" class="mission-dashboard-overlay hidden">
            <div class="mission-dashboard-tile left-tile">
                <div class="tile-header ambient-blue">Mission Telemetry</div>
                <div class="tile-content" id="mission-telemetry-content">
                    <!-- Telemetry, graphs, and subsystem data will go here -->
                    <div class="telemetry-placeholder">Select a satellite to view telemetry.</div>
                </div>
            </div>
            <div class="mission-dashboard-tile model-tile">
                <div class="tile-header ambient-orange">3D Satellite Model</div>
                <div class="tile-content" id="mission-model-content">
                    <!-- 3D model viewer canvas -->
                    <canvas id="modelCanvas" style="width:100%; height:100%; display:block; position:absolute; top:0; left:0; z-index:10;"></canvas>
                </div>
            </div>
            <button id="close-mission-dashboard" class="close-mission-dashboard">&times;</button>
        </div>
    </div>

    <script>
        const facts = [
            'There are over 34,000 objects larger than 10cm currently orbiting Earth.',
            'The ISS travels at approximately 7.66 km/s to stay in orbit.',
            'The Moon drifts away from Earth at about 3.8 cm per year.',
            'A day on Venus is longer than its year due to its slow rotation.',
            'Saturnâ€™s rings consist mostly of ice particles mixed with rock.'
        ];
        let factIndex = 0;
        function rotateFact() {
            factIndex = (factIndex + 1) % facts.length;
            document.querySelector('#space-fact p').textContent = facts[factIndex];
        }
        // Start rotating facts immediately
        rotateFact();
        setInterval(rotateFact, 4000);

        // Show/hide the note and controls only on click, and auto-hide tip after timeout or click-out
        (function() {
            const timeDisplay = document.getElementById('time-display');
            const currentTime = document.getElementById('current-time');
            const controlsPanel = document.getElementById('time-controls');
            const note = document.getElementById('time-info-note');
            let tipTimeout = null;
            let controlsOpen = false;

            // Ensure tip and controls are hidden on page load
            controlsPanel.classList.add('hidden');
            note.style.display = 'none';

            function showControlsAndTip() {
                controlsPanel.classList.remove('hidden');
                note.style.display = 'flex';
                controlsOpen = true;
                clearTimeout(tipTimeout);
                tipTimeout = setTimeout(hideTipAndControls, 10000); // auto-hide after 10s
            }
            function hideTipAndControls() {
                controlsPanel.classList.add('hidden');
                note.style.display = 'none';
                controlsOpen = false;
                clearTimeout(tipTimeout);
            }
            currentTime.addEventListener('click', function(e) {
                e.stopPropagation();
                if (!controlsOpen) {
                    showControlsAndTip();
                } else {
                    hideTipAndControls();
                }
            });
            // Hide when clicking outside
            document.addEventListener('mousedown', function(e) {
                if (!timeDisplay.contains(e.target)) {
                    hideTipAndControls();
                }
            });
            // Hide on ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') hideTipAndControls();
            });
            // Prevent accidental close when clicking inside
            controlsPanel.addEventListener('mousedown', function(e) { e.stopPropagation(); });
            note.addEventListener('mousedown', function(e) { e.stopPropagation(); });
        })();
        // Hide time display during loading screen
        (function() {
            const loadingScreen = document.getElementById('loading-screen');
            const body = document.body;
            function updateTimeDisplayVisibility() {
                if (loadingScreen && loadingScreen.style.display !== 'none') {
                    body.classList.add('hide-time');
                } else {
                    body.classList.remove('hide-time');
                }
            }
            // Initial check
            updateTimeDisplayVisibility();
            // Observe loading screen visibility changes
            const observer = new MutationObserver(updateTimeDisplayVisibility);
            observer.observe(loadingScreen, { attributes: true, attributeFilter: ['style'] });
        })();
        // Make time control buttons clickable even when tip/controls are open
        (function() {
            const controlsPanel = document.getElementById('time-controls');
            const timeDisplay = document.getElementById('time-display');
            // Ensure pointer events are enabled
            controlsPanel.style.pointerEvents = 'auto';
            timeDisplay.style.pointerEvents = 'auto';
        })();
        // Toggle help sphere visibility with loading screen
        (function() {
            const loadingScreen = document.getElementById('loading-screen');
            const helpBtn = document.getElementById('help-sphere-btn');
            function updateHelpVisibility() {
                if (loadingScreen.style.display === 'none') {
                    helpBtn.style.display = 'block';
                } else {
                    helpBtn.style.display = 'none';
                }
            }
            // Observe loading screen hiding
            const observer = new MutationObserver(updateHelpVisibility);
            observer.observe(loadingScreen, { attributes: true, attributeFilter: ['style'] });
            // Initial check
            updateHelpVisibility();
        })();
        // Help sphere toggle and close on canvas click
        (function() {
            const helpBtn = document.getElementById('help-sphere-btn');
            const helpModal = document.getElementById('help-modal');
            const tutorialModal = document.getElementById('welcome-modal');
            const showTutorialBtn = document.getElementById('help-show-tutorial');
            const closeHelpBtn = document.getElementById('help-close-btn');
            const canvas = document.getElementById('renderCanvas');
            // Toggle panel on sphere click
            helpBtn.addEventListener('click', () => helpModal.classList.toggle('open'));
            // Close panel via close button
            closeHelpBtn.addEventListener('click', () => helpModal.classList.remove('open'));
            // Open full tutorial
            showTutorialBtn.addEventListener('click', () => {
                helpModal.classList.remove('open');
                tutorialModal.style.display = 'flex';
            });
            // Close panel when clicking on simulation canvas
            canvas.addEventListener('click', () => helpModal.classList.remove('open'));
        })();
    </script>
</body>
</html>
