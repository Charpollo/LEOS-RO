<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEOS: First Orbit - Satellite Visualization</title>
    <link rel="stylesheet" href="css/brand-ui.css">
    <!-- Load the bundled JavaScript only once -->
    <script defer src="dist/js/bundle.js"></script>
</head>
<body>
    <div id="renderCanvas-container">
        <canvas id="renderCanvas" touch-action="none"></canvas>
        
        <!-- Loading Screen with Space Facts -->
        <div id="loading-screen">
            <div class="loading-content">
                <div class="leos-logo"><span class="highlight">LEOS</span>: First Orbit</div>
                <div class="loading-subtitle">
                  <span class="subtitle-word">Navigate.</span>
                  <span class="subtitle-word">Educate.</span>
                  <span class="subtitle-word">Operate.</span>
                </div>
                <div class="loader">
                    <div class="loader-ring"></div>
                    <div class="loader-ring"></div>
                    <div class="loader-ring"></div>
                </div>
                <div class="space-fact" id="space-fact">
                    <p>Did you know? There are over 34,000 objects larger than 10cm currently orbiting Earth.</p>
                </div>
            </div>
        </div>

        <!-- Welcome Modal (Tutorial) -->
        <div id="welcome-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <h2 class="modal-title">Welcome to LEOS: First Orbit</h2>
                <div class="tutorial-section">
                    <h3>Controls & Navigation</h3>
                    <div class="control-item">
                        <span class="control-key">Mouse Drag</span>
                        <span class="control-desc">Rotate Earth view</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">Mouse Wheel</span>
                        <span class="control-desc">Zoom in/out</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">Click Satellite</span>
                        <span class="control-desc">View satellite info</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">R Key</span>
                        <span class="control-desc">Reset view</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">Space Key</span>
                        <span class="control-desc">Pause/Resume</span>
                    </div>
                </div>
                <button id="got-it-btn" class="primary-button">Got it!</button>
            </div>
        </div>

        <!-- Left Info Panel (Mission Briefing) -->
        <div id="info-panel" class="info-panel">
            <div class="panel-header">
                <h1 class="panel-title">LEOS: First Orbit</h1>
                <button id="close-panel" class="close-button">&times;</button>
            </div>
            
            <div class="panel-section">
                <h2 class="section-title">The LEOS Engine</h2>
                <p class="section-content">
                    The Low Earth Orbit Simulation (LEOS) engine provides real-time orbital mechanics 
                    visualization using advanced 3D rendering and physics calculations. Experience 
                    satellite behavior in a scientifically accurate environment.
                </p>
            </div>
            
            <div class="panel-section">
                <h2 class="section-title">About the Satellites</h2>
                <p class="section-content">
                    Our simulation features active satellites with real telemetry data, including 
                    position, velocity, altitude, and orbital parameters. Each satellite follows 
                    precise Keplerian orbital mechanics.
                </p>
            </div>
            
            <div class="panel-section">
                <h2 class="section-title">Orbital Mechanics</h2>
                <p class="section-content">
                    Watch as satellites follow elliptical orbits, experience orbital decay, and 
                    maintain their trajectories around Earth. The simulation accounts for 
                    gravitational forces and orbital perturbations.
                </p>
            </div>

            <div class="panel-controls">
                <button id="show-tutorial" class="secondary-button">Show Tutorial</button>
            </div>
        </div>
        
        <!-- Floating Time Display -->
        <div id="time-display" class="floating-display" style="position:absolute; top:24px; left:50%; transform:translateX(-50%); z-index:3000; min-width:220px; text-align:center;">
            <div id="current-time" style="font-size:1.18em; font-weight:600; letter-spacing:0.04em; color:#66d9ff; background:rgba(0,23,40,0.92); border-radius:8px; padding:0.5em 1.2em; box-shadow:0 2px 12px #00cfff33; border:1px solid #00cfff; display:inline-block; cursor:pointer;">
                00:00:00 UTC
            </div>
            <div id="time-controls" class="time-controls-panel hidden" style="margin-top:8px;">
                <button class="time-btn speed-btn" data-mult="0.25">0.25x</button>
                <button class="time-btn speed-btn" data-mult="0.5">0.5x</button>
                <button class="time-btn speed-btn" data-mult="1">1x</button>
                <button class="time-btn speed-btn" data-mult="2">2x</button>
                <button class="time-btn speed-btn" data-mult="4">4x</button>
            </div>
            <div id="time-info-note" style="display:none; position:absolute; left:50%; top:calc(100% + 18px); transform:translateX(-50%); min-width:600px; max-width:900px; background:rgba(10,18,32,0.98); color:#66d9ff; font-size:1em; border-radius:22px; box-shadow:0 8px 36px #00cfff22; padding:1.5em 2.8em 1.5em 2.2em; z-index:3500; text-align:left; border:none; line-height:1.7; pointer-events:auto; outline:none; display:flex; flex-direction:column; gap:0.5em; align-items:flex-start; font-weight:400; opacity:0.97;">
                <b>Tip:</b> Simulation time runs at a 60:1 ratio (1 real second = 1 simulated minute). The speed you select multiplies this effect.
            </div>
        </div>
        
        <!-- Mission Dashboard Overlay (hidden by default) -->
        <div id="mission-dashboard" class="mission-dashboard-overlay hidden">
            <div class="mission-dashboard-tile left-tile">
                <div class="tile-header ambient-blue">Mission Telemetry</div>
                <div class="tile-content" id="mission-telemetry-content">
                    <!-- Telemetry, graphs, and subsystem data will go here -->
                    <div class="telemetry-placeholder">Select a satellite to view telemetry.</div>
                </div>
            </div>
            <div class="mission-dashboard-tile model-tile">
                <div class="tile-header ambient-orange">3D Satellite Model</div>
                <div class="tile-content" id="mission-model-content">
                    <!-- 3D model viewer canvas -->
                    <canvas id="modelCanvas" style="width:100%; height:100%; display:block; position:absolute; top:0; left:0; z-index:10;"></canvas>
                </div>
            </div>
            <button id="close-mission-dashboard" class="close-mission-dashboard">&times;</button>
        </div>
    </div>

    <script>
        const facts = [
            'There are over 34,000 objects larger than 10cm currently orbiting Earth.',
            'The ISS travels at approximately 7.66 km/s to stay in orbit.',
            'The Moon drifts away from Earth at about 3.8 cm per year.',
            'A day on Venus is longer than its year due to its slow rotation.',
            'Saturnâ€™s rings consist mostly of ice particles mixed with rock.'
        ];
        let factIndex = 0;
        function rotateFact() {
            factIndex = (factIndex + 1) % facts.length;
            document.querySelector('#space-fact p').textContent = facts[factIndex];
        }
        // Start rotating facts immediately
        rotateFact();
        setInterval(rotateFact, 4000);

        // Show/hide the note and controls only on click, and auto-hide tip after timeout or click-out
        (function() {
            const timeDisplay = document.getElementById('time-display');
            const currentTime = document.getElementById('current-time');
            const controlsPanel = document.getElementById('time-controls');
            const note = document.getElementById('time-info-note');
            let tipTimeout = null;
            let controlsOpen = false;

            // Ensure tip and controls are hidden on page load
            controlsPanel.classList.add('hidden');
            note.style.display = 'none';

            function showControlsAndTip() {
                controlsPanel.classList.remove('hidden');
                note.style.display = 'flex';
                controlsOpen = true;
                clearTimeout(tipTimeout);
                tipTimeout = setTimeout(hideTipAndControls, 10000); // auto-hide after 10s
            }
            function hideTipAndControls() {
                controlsPanel.classList.add('hidden');
                note.style.display = 'none';
                controlsOpen = false;
                clearTimeout(tipTimeout);
            }
            currentTime.addEventListener('click', function(e) {
                e.stopPropagation();
                if (!controlsOpen) {
                    showControlsAndTip();
                } else {
                    hideTipAndControls();
                }
            });
            // Hide when clicking outside
            document.addEventListener('mousedown', function(e) {
                if (!timeDisplay.contains(e.target)) {
                    hideTipAndControls();
                }
            });
            // Hide on ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') hideTipAndControls();
            });
            // Prevent accidental close when clicking inside
            controlsPanel.addEventListener('mousedown', function(e) { e.stopPropagation(); });
            note.addEventListener('mousedown', function(e) { e.stopPropagation(); });
        })();
        // Hide time display during loading screen
        (function() {
            const loadingScreen = document.getElementById('loading-screen');
            const body = document.body;
            function updateTimeDisplayVisibility() {
                if (loadingScreen && loadingScreen.style.display !== 'none') {
                    body.classList.add('hide-time');
                } else {
                    body.classList.remove('hide-time');
                }
            }
            // Initial check
            updateTimeDisplayVisibility();
            // Observe loading screen visibility changes
            const observer = new MutationObserver(updateTimeDisplayVisibility);
            observer.observe(loadingScreen, { attributes: true, attributeFilter: ['style'] });
        })();
        // Make time control buttons clickable even when tip/controls are open
        (function() {
            const controlsPanel = document.getElementById('time-controls');
            const timeDisplay = document.getElementById('time-display');
            // Ensure pointer events are enabled
            controlsPanel.style.pointerEvents = 'auto';
            timeDisplay.style.pointerEvents = 'auto';
        })();
    </script>
</body>
</html>
