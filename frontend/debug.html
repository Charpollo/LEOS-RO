<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LEOS Asset Troubleshooter</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f4f4f8;
      color: #333;
    }
    h1 {
      color: #0288d1;
      border-bottom: 2px solid #0288d1;
      padding-bottom: 10px;
    }
    .asset-check {
      background-color: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      text-align: left;
      padding: 12px;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
    }
    .success {
      color: #4caf50;
      font-weight: bold;
    }
    .failed {
      color: #f44336;
      font-weight: bold;
    }
    .waiting {
      color: #ff9800;
      font-style: italic;
    }
    button {
      background-color: #0288d1;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #0277bd;
    }
    #results-container {
      margin-top: 20px;
      white-space: pre-wrap;
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      font-family: monospace;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <h1>LEOS: First Orbit - Asset Troubleshooter</h1>
  
  <div class="asset-check">
    <h2>Required Asset Check</h2>
    <p>This page will verify that all required 3D models and textures are accessible.</p>
    
    <button id="checkAssets">Check All Assets</button>
    <button id="forceReload">Force Cache Reload</button>
    
    <table id="assetTable">
      <thead>
        <tr>
          <th>Asset</th>
          <th>Status</th>
          <th>Size</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>assets/crts_satellite.glb</td>
          <td class="waiting">Not checked yet</td>
          <td>-</td>
        </tr>
        <tr>
          <td>assets/bulldog_satellite.glb</td>
          <td class="waiting">Not checked yet</td>
          <td>-</td>
        </tr>
        <tr>
          <td>assets/earth_diffuse.png</td>
          <td class="waiting">Not checked yet</td>
          <td>-</td>
        </tr>
        <tr>
          <td>assets/earth_clouds.jpg</td>
          <td class="waiting">Not checked yet</td>
          <td>-</td>
        </tr>
        <tr>
          <td>assets/moon_texture.jpg</td>
          <td class="waiting">Not checked yet</td>
          <td>-</td>
        </tr>
        <tr>
          <td>assets/leos_logo.png</td>
          <td class="waiting">Not checked yet</td>
          <td>-</td>
        </tr>
      </tbody>
    </table>
    
    <h3>Detailed Results</h3>
    <div id="results-container">Run the check to see detailed results...</div>
  </div>
  
  <div class="asset-check">
    <h2>Manual Path Check</h2>
    <p>Test if a specific asset path is accessible:</p>
    <input type="text" id="manualPath" placeholder="Enter asset path (e.g., assets/bulldog_satellite.glb)" style="width: 80%; padding: 8px;">
    <button id="checkManualPath">Check</button>
    <div id="manualResult" style="margin-top: 10px; font-family: monospace;"></div>
  </div>
  
  <div class="asset-check">
    <h2>Troubleshooting Tips</h2>
    <ul>
      <li><strong>File not found errors</strong>: Make sure the file exists in the correct location and has the correct name (case-sensitive).</li>
      <li><strong>Model loading issues</strong>: Try a different browser or clear your cache.</li>
      <li><strong>Invalid model files</strong>: Verify that your GLB files are valid using the <a href="https://github.khronos.org/glTF-Validator/" target="_blank">glTF Validator</a>.</li>
      <li><strong>Return to application</strong>: <a href="./index.html">Go back to LEOS: First Orbit</a></li>
    </ul>
  </div>
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const assetPaths = [
        'assets/crts_satellite.glb',
        'assets/bulldog_satellite.glb',
        'assets/earth_diffuse.png',
        'assets/earth_clouds.jpg',
        'assets/moon_texture.jpg',
        'assets/leos_logo.png'
      ];
      
      const resultsContainer = document.getElementById('results-container');
      const tableRows = document.querySelectorAll('#assetTable tbody tr');
      
      function checkAsset(path, index) {
        const row = tableRows[index];
        const statusCell = row.querySelector('td:nth-child(2)');
        const sizeCell = row.querySelector('td:nth-child(3)');
        
        statusCell.textContent = "Checking...";
        statusCell.className = "waiting";
        
        // Add cache-busting query parameter
        const cacheBuster = document.getElementById('forceReload').dataset.forceClear === 'true' ? 
          `?cache=${Date.now()}` : '';
        
        fetch(`${path}${cacheBuster}`, {method: 'HEAD'})
          .then(response => {
            if (response.ok) {
              statusCell.textContent = "✅ Found";
              statusCell.className = "success";
              return response;
            } else {
              statusCell.textContent = `❌ Not Found (${response.status})`;
              statusCell.className = "failed";
              throw new Error(`HTTP ${response.status}`);
            }
          })
          .then(response => {
            // Get file size
            return fetch(`${path}${cacheBuster}`).then(r => r.blob());
          })
          .then(blob => {
            const size = (blob.size / 1024).toFixed(2);
            sizeCell.textContent = `${size} KB`;
            addResult(`✅ ${path}: ${size} KB`);
          })
          .catch(error => {
            sizeCell.textContent = "-";
            addResult(`❌ ${path}: ${error.message}`);
          });
      }
      
      function addResult(message) {
        resultsContainer.textContent += message + "\n";
        resultsContainer.scrollTop = resultsContainer.scrollHeight;
      }
      
      document.getElementById('checkAssets').addEventListener('click', function() {
        resultsContainer.textContent = "Checking assets...\n";
        
        // Check each asset
        assetPaths.forEach((path, index) => {
          checkAsset(path, index);
        });
      });
      
      document.getElementById('forceReload').addEventListener('click', function() {
        this.dataset.forceClear = 'true';
        resultsContainer.textContent = "Force reloading assets (cache disabled)...\n";
        
        // Check each asset with cache clearing
        assetPaths.forEach((path, index) => {
          checkAsset(path, index);
        });
      });
      
      document.getElementById('checkManualPath').addEventListener('click', function() {
        const path = document.getElementById('manualPath').value.trim();
        const resultDiv = document.getElementById('manualResult');
        
        if (!path) {
          resultDiv.textContent = "Please enter a path to check";
          return;
        }
        
        resultDiv.textContent = `Checking ${path}...`;
        
        fetch(path, {method: 'HEAD'})
          .then(response => {
            if (response.ok) {
              resultDiv.innerHTML = `<span class="success">✅ File exists (HTTP ${response.status})</span>`;
              return response;
            } else {
              resultDiv.innerHTML = `<span class="failed">❌ File not found (HTTP ${response.status})</span>`;
              throw new Error(`HTTP ${response.status}`);
            }
          })
          .then(response => fetch(path))
          .then(response => response.blob())
          .then(blob => {
            const size = (blob.size / 1024).toFixed(2);
            resultDiv.innerHTML += `<br>File size: ${size} KB`;
            resultDiv.innerHTML += `<br>Content type: ${blob.type}`;
          })
          .catch(error => {
            if (!resultDiv.textContent.includes('not found')) {
              resultDiv.innerHTML += `<br><span class="failed">Error: ${error.message}</span>`;
            }
          });
      });
    });
  </script>
</body>
</html>
